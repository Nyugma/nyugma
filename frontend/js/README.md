# Frontend JavaScript Files

This directory contains the JavaScript files for the Legal Case Similarity frontend application.

## Files

### Core Application Files

- **app.js**: Main application logic for the search interface
  - Handles file upload
  - Displays search results
  - Manages UI interactions
  - Communicates with the backend API

- **config.js**: Configuration module for environment-specific settings
  - Detects development vs production environment
  - Provides backend API URL
  - Exports `window.AppConfig` for use by other modules

### Environment Configuration

- **env.js.template**: Template file for generating production environment configuration
  - Contains placeholder `${BACKEND_URL}` that gets replaced during build
  - Used by build scripts to generate `env.js`
  - **Do not edit this file directly**

- **env.js**: Generated file containing production backend URL (not in repository)
  - Generated by `build.sh` or `build.ps1` during deployment
  - Sets `window.ENV.BACKEND_URL` for production use
  - **This file is gitignored and should never be committed**
  - For local development, this file is not needed (config.js defaults to localhost:8000)

## Build Process

### For Deployment Platforms (Netlify, Vercel, etc.)

The build scripts generate `env.js` from `env.js.template` using the `BACKEND_URL` environment variable:

**Linux/Mac (bash)**:
```bash
cd frontend
export BACKEND_URL=https://your-api.onrender.com
bash build.sh
```

**Windows (PowerShell)**:
```powershell
cd frontend
$env:BACKEND_URL="https://your-api.onrender.com"
.\build.ps1
```

Or with parameter:
```powershell
.\build.ps1 -BackendUrl "https://your-api.onrender.com"
```

### For Local Development

No build step is needed for local development. The `config.js` file automatically detects when running on localhost and uses `http://localhost:8000` as the backend URL.

Simply open the HTML files in a browser or serve them with a local web server:

```bash
# Python
python -m http.server 8080

# Node.js
npx http-server -p 8080

# PHP
php -S localhost:8080
```

## Configuration Flow

1. **HTML loads scripts in order**:
   ```html
   <script src="js/env.js"></script>      <!-- Only in production -->
   <script src="js/config.js"></script>
   <script src="js/app.js"></script>
   ```

2. **env.js sets window.ENV** (production only):
   ```javascript
   window.ENV = {
       BACKEND_URL: 'https://your-api.onrender.com'
   };
   ```

3. **config.js reads environment**:
   ```javascript
   getBackendUrl: function() {
       // Development: use localhost
       if (window.location.hostname === 'localhost') {
           return 'http://localhost:8000';
       }
       // Production: use ENV or default
       return window.ENV?.BACKEND_URL || 'https://your-api.onrender.com';
   }
   ```

4. **app.js uses config**:
   ```javascript
   this.apiBaseUrl = window.AppConfig.getBackendUrl();
   ```

## Deployment Platform Configuration

### Netlify

Set environment variable in Site settings > Environment variables:
- **Key**: `BACKEND_URL`
- **Value**: `https://your-api.onrender.com`

Build command in `netlify.toml`:
```toml
[build]
  command = "bash build.sh"
```

### Vercel

Set environment variable in Project settings > Environment Variables:
- **Key**: `BACKEND_URL`
- **Value**: `https://your-api.onrender.com`

Build command in `vercel.json`:
```json
{
  "buildCommand": "bash build.sh"
}
```

### GitHub Pages

GitHub Pages doesn't support custom build commands with environment variables. Options:

1. **Manual build**: Run build script locally and commit `env.js`
2. **GitHub Actions**: Use workflow to build and deploy (see DEPLOYMENT.md)
3. **Use default**: Let config.js use its default fallback URL

## Troubleshooting

### Issue: Frontend uses wrong backend URL

**Check**:
1. Is `env.js` present in production? (Should be generated by build script)
2. Does `env.js` contain the correct URL? (Not the `${BACKEND_URL}` placeholder)
3. Is `env.js` loaded before `config.js` in HTML?

**Solution**:
- Verify `BACKEND_URL` environment variable is set in deployment platform
- Check build logs to ensure build script ran successfully
- Manually inspect deployed `env.js` file

### Issue: CORS errors in production

**Check**:
1. Is backend CORS configured to allow your frontend domain?
2. Is backend URL using HTTPS? (Required if frontend is HTTPS)

**Solution**:
- Add frontend domain to backend's `CORS_ORIGINS` environment variable
- Example: `CORS_ORIGINS=https://your-site.netlify.app,https://your-site.vercel.app`

### Issue: env.js not generated during build

**Check**:
1. Is build script being run? (Check deployment logs)
2. Is `BACKEND_URL` environment variable set?
3. Does `env.js.template` exist?

**Solution**:
- Verify build command in deployment configuration
- Set `BACKEND_URL` in deployment platform settings
- Check that `env.js.template` is in repository

## Security Notes

- **Never commit `env.js`**: It's generated during deployment and gitignored
- **Use HTTPS in production**: Always use `https://` URLs for production backends
- **Validate environment variables**: Build scripts check for missing or invalid values
- **Keep secrets out of frontend**: Never put API keys or secrets in frontend code

## Additional Resources

- [Frontend Deployment Guide](../DEPLOYMENT.md)
- [Backend API Documentation](../../README.md)
- [Configuration Module Documentation](config.js)
